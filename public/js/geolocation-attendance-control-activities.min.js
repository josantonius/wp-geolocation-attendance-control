document.addEventListener("DOMContentLoaded",function(){new Vue({el:"#app",data:t=>({selectedUsers:[2],users:[{avatar:"https://cdn.vuetifyjs.com/images/lists/1.jpg",headline:"Alex Díaz",title:"Ali Connors",subtitle:"I'll be in your neighborhood doing errands this weekend. Do you want to hang out?"},{avatar:"https://cdn.vuetifyjs.com/images/lists/2.jpg",headline:"Summer BBQ",title:"me, Scrott, Jennifer",subtitle:"Wish I could come, but I'm out of town this weekend."},{avatar:"https://cdn.vuetifyjs.com/images/lists/3.jpg",headline:"Oui oui",title:"Sandra Adams",subtitle:"Do you have Paris recommendations? Have you ever been?"},{avatar:"https://cdn.vuetifyjs.com/images/lists/4.jpg",headline:"Birthday gift",title:"Trevor Hansen",subtitle:"Have any ideas about what we should get Heidi for her birthday?"},{avatar:"https://cdn.vuetifyjs.com/images/lists/5.jpg",headline:"Recipe to try",title:"Britta Holt",subtitle:"We should eat this: Grate, Squash, Corn, and tomatillo Tacos."}],centres:[],selectedCentre:null,activities:[],selectedActivity:null,selected:[],search:"",place:null,days:[{text:"Lunes",value:1},{text:"Martes",value:2},{text:"Miércoles",value:3},{text:"Jueves",value:4},{text:"Viernes",value:5},{text:"Sábado",value:6},{text:"Domingo",value:7}],selectedDays:[1,2,3,4,5,6,7],months:[{text:"Enero",value:1},{text:"Febrero",value:2},{text:"Marzo",value:3},{text:"Abril",value:4},{text:"Mayo",value:5},{text:"Junio",value:6},{text:"Julio",value:7},{text:"Agosto",value:8},{text:"Septiembre",value:9},{text:"Octubre",value:10},{text:"Noviembre",value:11},{text:"Diciembre",value:12}],selectedMonths:[1,2,3,4,5,6,7,8,9,10,11,12],snackbar:!1,snackbarMessage:"Text",isEdit:!1,dialogUsers:!0,state:!0,persistent:!1,centre:"",addressType:"address",pageName:"Actividades",customLatitude:"",customLongitude:"",lastCoordinates:null,activity:"",headerTitle:"Centros",startTime:!1,display:!0,start_hour:null,endTime:!1,patt:/^\s*[-+]?([1-8]?\d(\.\d+)?|90(\.0+)?)\s*,\s*[-+]?(180(\.0+)?|((1[0-7]\d)|([1-9]?\d))(\.\d+)?)\s*$/,end_hour:null,timeout:15e3,pagination:{descending:!0,page:1,rowsPerPage:10,sortBy:"id"},placeholder:"Dirección",className:"",id:"",value:"",options:{componentRestrictions:{country:"es"}},currentID:null,zoom:10,center:{lat:37.392529,lng:-5.994072},width:"100%",height:"400px",page:"centres",maxHeight:"600px",maxWidth:"100%",markers:[],toolbarTitle:"Asistencias",toolbarColor:"indigo",formatDate:"DD [de] MMMM [de] YYYY",formatHour:"hh:mm",defaultDateOrder:"DEC",defaultHourOrder:"DEC",locale:"es",dialog:!1,dialogConfirm:!1,dialogTitle:"",dialogSubtitle:"",headers:[{text:"ID",align:"left",value:"id",sortable:!0},{text:"Actividad",align:"left",value:"activity",sortable:!0},{text:"Centro",align:"left",value:"centre",sortable:!0},{text:"Inicio",value:"start_hour",sortable:!0,align:"left"},{text:"Fin",value:"end_hour",sortable:!0,align:"left"},{text:"Estado",value:"state",sortable:!0,align:"left"},{text:"Acciones",value:"centre",sortable:!1,align:"center"}]}),created(){this.selectCentres(),this.selectActivities(),setTimeout(()=>{this.selectCentres(),this.selectActivities()},18e4)},methods:{getTemplate:(t,e,s,i)=>`\n          <div class="gac-content">\n            <div class="gac-heading">\n              <h1 class="gac-first-heading">${t}</h1>\n              <h3 class="gac-second-heading">${i}</span></h3>\n              \n            </div>\n            <div class="gac-bodyContent">\n              <p>${e}, ${s}</p>\n            </div>\n          </div>\n        `,onChangeCoordinates(){console.log("onChangeCoordinates");let t=this.customLatitude+","+this.customLongitude;if(t=t.replace(/ /g,""),!this.patt.test(t)||t===this.lastCoordinates)return!1;this.setAddressByCoordinates(parseFloat(this.customLatitude),parseFloat(this.customLongitude)),this.lastCoordinates=t},setAddressByCoordinates(t,e){let s=google.maps,i=new s.Geocoder,a=new s.LatLng(t,e);i.geocode({location:a},(t,e)=>{console.log("setAddressByCoordinates"),t[0]&&e===s.GeocoderStatus.OK?(this.$refs.autocomplete.setPlace(t[0]),this.$refs.autocomplete.$refs.gmap.$refs.input.value=t[0].formatted_address):this.clear()})},request(t,e,s){var i=new URLSearchParams;for(var a in s=s||{},i.append("action",e),i.append("nonce",geolocationAttendanceControlActivities.nonce),s)i.append(a,s[a]),console.log(a,s[a]);return new Promise((e,s)=>axios({method:t,url:geolocationAttendanceControlActivities.ajax_url,data:i}).then(t=>{e(t.data)}).catch(t=>{console.log(t),s(t)}))},selectCentres(){this.request("post","select_all_centres").then(t=>{this.centres=t}).catch(t=>{console.log(t)})},selectActivities(){this.markers=[],this.request("post","select_activities").then(t=>{this.activities=t,console.log(t),document.querySelector(".opacity-on").classList.add("opacity-off")}).catch(t=>{console.log(t)})},getData(){let t=this.selectedCentre.id,e=this.centres.findIndex(e=>e.id===t);return{id:this.currentID,centre_id:t,centre:this.centres[e].centre,activity:this.selectedActivity,start_hour:this.start_hour,end_hour:this.end_hour,days:"",months:"",state:this.state?1:0}},insertActivity(){var t=this.getData();console.log(t),this.request("post","insert_activity",t).then(e=>{console.log("RES",e),e&&(t.id=e,this.activities.push(t),this.close())}).catch(t=>{console.log(t)})},dialogEditActivity(t){console.log("ssss",t);let e=this.centres.findIndex(e=>e.id===t.centre_id);this.state=1===parseInt(t.state),this.currentID=t.id,this.selectedCentre=this.centres[e],this.selectedActivity=t.activity,this.start_hour=t.start_hour,this.end_hour=t.end_hour;let s=t.days.split(",")||[];this.selectedDays=s.map(t=>parseInt(t));let i=t.months.split(",")||[];this.selectedMonths=i.map(t=>parseInt(t)),this.state=1===parseInt(t.state),this.persistent=!0,this.isEdit=!0,this.dialog=!0},updateActivity(){let t=this.getData();t.id=this.currentID,this.request("post","update_activity",t).then(t=>{this.editActivity(),this.close()}).catch(t=>{console.log(t)})},deleteActivity(t){var e={id:t};let s=this.activities.findIndex(e=>e.id===t);this.request("post","delete_activity",e).then(t=>{t&&this.activities.splice(s,1)}).catch(t=>{console.log(t)})},onOpenMarker(t,e){console.info("onOpenMarker",t,e)},onCloseMarker(t,e){console.info("onCloseMarker",t,e)},onCLickMarker(t,e){console.info("onCLickMarker",t,e)},onKeyUp(t){console.info("onKeyUp",t)},onKeyPress(t){console.info("onKeyPress",t)},onFocus(){console.info("onFocus")},onBlur(){console.info("onBlur")},onChange(){console.info("onChange")},onPlaceChanged(t){t.location.lat&&t.location.lng&&t.place_id&&t.formatted_address?this.place=t:this.place=null,this.customLatitude=t.location.lat,this.customLongitude=t.location.lng,console.info("onPlaceChanged",t)},clear(){this.place=null,this.$refs.autocomplete.clear(),this.$refs.autocomplete.$refs.gmap.$refs.input.value=""},deleteItemAsk(t){this.dialogTitle="¿Eliminar actividad?",this.dialogSubtitle='Si eliminas "'+t.activity+'" se borrarán todos los registros de asistencias asociados con esta actividad.',this.dialogConfirm=!0,this.currentID=t.id},deleteItems(){this.dialogTitle="",this.dialogSubtitle="",this.dialogConfirm=!1,null!==this.currentID?this.deleteActivity(this.currentID):this.deleteSelectedItems()},deleteItemsAsk(){this.dialogTitle="¿Eliminar actividades?",this.dialogSubtitle="Si las eliminas se borrarán todos los registros de asistencias asociados con estas actividades.",this.dialogConfirm=!0},deleteSelectedItems(){this.selected.forEach(t=>{this.deleteActivity(t.id)}),this.selected=[]},openDialog(){this.$vuetify.goTo(0),document.body.scrollTo(0,0),this.dialog=!0},toggleUser(t){const e=this.selectedUsers.indexOf(t);e>-1?this.selectedUsers.splice(e,1):this.selectedUsers.push(t)},close(){this.dialog=!1,this.isEdit=!1,this.resetForm()},editActivity(){let t=this.activities.findIndex(t=>parseInt(t.id)===parseInt(this.currentID));if(-1!==t){let e=this.getData();this.activities[t].activity=e.activity,this.activities[t].centre=this.selectedCentre.centre,this.activities[t].centre_id=this.selectedCentre.id,this.activities[t].days=e.days,this.activities[t].end_hour=e.end_hour,this.activities[t].id=e.id,this.activities[t].months=e.months,this.activities[t].start_hour=e.start_hour,this.activities[t].state=e.state,this.close()}},goToMarker(t){this.$refs.google_maps_places_aggregator.infoWinOpen=!1,this.$refs.google_maps_places_aggregator.infoWindowPos=t.position,this.$refs.google_maps_places_aggregator.infoOptions.content=t.infoText,this.$refs.google_maps_places_aggregator.infoWinOpen=!0,this.$vuetify.goTo(0),document.body.scrollTo(0,0),this.centerMap(t.position),this.zoomMap(15)},addMarker(t,e){e?this.markers[e]=t:this.markers.push(t)},centerMap(t){this.center=t},zoomMap(t){this.zoom=t},resetForm(){this.selectedCentre=null,this.selectedActivity=null,this.start_hour=null,this.end_hour=null,this.selectedDays=this.days,this.selectedMonths=this.months,this.state=!0}},watch:{dialog(t){t||this.close()}},computed:{valid:function(){return console.log(this.selectedCentre,this.selectedActivity,this.start_hour,this.end_hour),this.selectedCentre&&this.selectedActivity&&this.start_hour&&this.end_hour},formTitle(){return-1===this.editedIndex?"New Item":"Edit Item"},activitiesList(){let t=[];return this.activities.forEach((e,s)=>t.push(e.activity)),t}}})});