document.addEventListener("DOMContentLoaded",function(){Vue.component("gmap-autocomplete",VueGoogleMaps.Autocomplete),Vue.component("gmap-map",VueGoogleMaps.Map),Vue.component("VueGoogleMapsPlacesAggregator",VueGoogleMapsPlacesAggregator.VueGoogleMapsPlacesAggregator),Vue.component("VueGoogleAutocomplete",VueGoogleAutocomplete.VueGoogleAutocomplete),Vue.use(VueGoogleMaps,{load:{key:geolocationAttendanceControlPlaces.google_api_key,libraries:"places"}}),new Vue({el:"#app",data:e=>({selected:[],search:"",place:null,snackbar:!1,snackbarMessage:"Text",isEdit:!1,state:!0,persistent:!1,centre:"",addressType:"address",pageName:"Centros",customLatitude:"",customLongitude:"",lastCoordinates:null,activity:"",headerTitle:"Centros",startTime:!1,display:!0,start_hour:null,endTime:!1,patt:/^\s*[-+]?([1-8]?\d(\.\d+)?|90(\.0+)?)\s*,\s*[-+]?(180(\.0+)?|((1[0-7]\d)|([1-9]?\d))(\.\d+)?)\s*$/,end_hour:null,timeout:15e3,pagination:{descending:!0,page:1,rowsPerPage:10,sortBy:"id"},placeholder:"Dirección",className:"",id:"",value:"",options:{componentRestrictions:{country:"es"}},currentID:null,zoom:10,center:{lat:37.392529,lng:-5.994072},width:"100%",height:"400px",page:"centres",maxHeight:"600px",maxWidth:"100%",markers:[],toolbarTitle:"Asistencias",toolbarColor:"indigo",formatDate:"DD [de] MMMM [de] YYYY",formatHour:"hh:mm",defaultDateOrder:"DEC",defaultHourOrder:"DEC",locale:"es",dialog:!1,dialogConfirm:!1,dialogTitle:"",dialogSubtitleA:"",dialogSubtitleB:"",headers:[{text:"ID",align:"left",value:"id",sortable:!0},{text:"Centro",align:"left",value:"centre",sortable:!0},{text:"Dirección",value:"address",sortable:!0,align:"left"},{text:"Estado",value:"state",sortable:!0,align:"left"},{text:"Acciones",value:"centre",sortable:!1,align:"center"}]}),created(){this.selectCentres(),setTimeout(()=>{this.selectCentres()},18e4)},methods:{getTemplate:(e,t,s,o)=>`\n          <div class="gac-content">\n            <div class="gac-heading">\n              <h1 class="gac-first-heading">${e}</h1>\n              <h3 class="gac-second-heading">${o}</span></h3>\n              \n            </div>\n            <div class="gac-bodyContent">\n              <p>${t}, ${s}</p>\n            </div>\n          </div>\n        `,onChangeCoordinates(){console.log("onChangeCoordinates");let e=this.customLatitude+","+this.customLongitude;if(e=e.replace(/ /g,""),!this.patt.test(e)||e===this.lastCoordinates)return!1;this.setAddressByCoordinates(parseFloat(this.customLatitude),parseFloat(this.customLongitude)),this.lastCoordinates=e},setAddressByCoordinates(e,t){let s=google.maps,o=new s.Geocoder,a=new s.LatLng(e,t);o.geocode({location:a},(e,t)=>{console.log("setAddressByCoordinates"),e[0]&&t===s.GeocoderStatus.OK?(this.$refs.autocomplete.setPlace(e[0]),this.$refs.autocomplete.$refs.gmap.$refs.input.value=e[0].formatted_address):this.clear()})},request(e,t,s){var o=new URLSearchParams;for(var a in s=s||{},o.append("action",t),o.append("nonce",geolocationAttendanceControlPlaces.nonce),s)o.append(a,s[a]),console.log(a,s[a]);return new Promise((t,s)=>axios({method:e,url:geolocationAttendanceControlPlaces.ajax_url,data:o}).then(e=>{t(e.data)}).catch(e=>{console.log(e),s(e)}))},selectCentres(){this.markers=[],this.request("post","select_centres").then(e=>{console.log(e),e.forEach(e=>{e.position={lat:parseFloat(e.latitude),lng:parseFloat(e.longitude)},e.infoText=this.getTemplate(e.centre,e.position.lat,e.position.lng,e.address),e.value=!1,e.clickable=!0,this.addMarker(e)}),console.log(this.markers),document.querySelector(".opacity-on").classList.add("opacity-off")}).catch(e=>{console.log(e)})},insertCentre(){var e={centre:this.centre,latitude:this.place.location.lat,longitude:this.place.location.lng,address:this.place.formatted_address,place_id:this.place.place_id,state:this.state?1:0};this.request("post","insert_centre",e).then(e=>{e&&this.saveMarker(e)}).catch(e=>{console.log(e)})},dialogEditCentre(e){console.log("ssss",e),this.place={location:e.position,formatted_address:e.address,place_id:e.place_id},this.$refs.autocomplete.$refs.gmap.$refs.input.value=e.address,this.customLatitude=e.position.lat,this.customLongitude=e.position.lng,this.lastCoordinates=this.customLatitude+","+this.customLongitude,this.state=1===parseInt(e.state),this.currentID=e.id,this.centre=e.centre,this.persistent=!0,this.isEdit=!0,this.dialog=!0},updateCentre(){var e={id:this.currentID,centre:this.centre,latitude:this.place.location.lat,longitude:this.place.location.lng,address:this.place.formatted_address,place_id:this.place.place_id,state:this.state?1:0};this.request("post","update_centre",e).then(e=>{this.$refs.google_maps_places_aggregator.infoWinOpen&&(this.$refs.google_maps_places_aggregator.infoWinOpen=!1),this.editMarker()}).catch(e=>{console.log(e)})},deleteCentre(e){var t={id:e};let s=this.markers.findIndex(t=>t.id===e);this.request("post","delete_centre",t).then(e=>{e&&this.markers.splice(s,1)}).catch(e=>{console.log(e)})},onOpenMarker(e,t){console.info("onOpenMarker",e,t)},onCloseMarker(e,t){console.info("onCloseMarker",e,t)},onCLickMarker(e,t){console.info("onCLickMarker",e,t)},onKeyUp(e){console.info("onKeyUp",e)},onKeyPress(e){console.info("onKeyPress",e)},onFocus(){console.info("onFocus")},onBlur(){console.info("onBlur")},onChange(){console.info("onChange")},onPlaceChanged(e){e.location.lat&&e.location.lng&&e.place_id&&e.formatted_address?this.place=e:this.place=null,this.customLatitude=e.location.lat,this.customLongitude=e.location.lng,console.info("onPlaceChanged",e)},clear(){this.place=null,this.$refs.autocomplete.clear(),this.$refs.autocomplete.$refs.gmap.$refs.input.value=""},deleteItemAsk(e){this.dialogTitle="¿Eliminar centro?",this.dialogSubtitleA='Si eliminas "'+e.centre+'" se borrarán todas las actividades realizadas en este centro.',this.dialogSubtitleB="Ten en cuenta que al eliminar los centros y sus actividades también se eliminarán todos los registros de asistencia asociados con estas actividades.",this.dialogConfirm=!0,this.currentID=e.id},deleteItems(){this.dialogTitle="",this.dialogSubtitleA="",this.dialogSubtitleB="",this.dialogConfirm=!1,null!==this.currentID?this.deleteCentre(this.currentID):this.deleteSelectedItems()},deleteItemsAsk(){this.dialogTitle="¿Eliminar centros?",this.dialogSubtitleA="Si los eliminas se borrarán todas las actividades realizadas en estos centros.",this.dialogSubtitleB="Ten en cuenta que al eliminar los centros y sus actividades también se eliminarán todos los registros de asistencia asociados con estas actividades.",this.dialogConfirm=!0},deleteSelectedItems(){this.selected.forEach(e=>{this.deleteCentre(e.id)}),this.selected=[]},openDialog(){this.$vuetify.goTo(0),document.body.scrollTo(0,0),this.dialog=!0},close(){this.dialog=!1,this.resetForm()},saveMarker(e,t){this.addMarker({id:e,centre:this.centre,activity:this.activity,state:this.state?1:0,latitude:this.place.location.lat,longitude:this.place.location.lng,position:{lat:this.place.location.lat,lng:this.place.location.lng},address:this.place.formatted_address,place_id:this.place.place_id,clickable:!0,infoText:this.getTemplate(this.centre,this.place.location.lat,this.place.location.lng,this.place.formatted_address)},t),this.centerMap(this.place.location),this.close(),this.zoomMap(15)},editMarker(){let e=this.markers.findIndex(e=>e.id==this.currentID);-1!==e&&(this.markers.splice(e,1),this.saveMarker(this.currentID))},goToMarker(e){this.$refs.google_maps_places_aggregator.infoWinOpen=!1,this.$refs.google_maps_places_aggregator.infoWindowPos=e.position,this.$refs.google_maps_places_aggregator.infoOptions.content=e.infoText,this.$refs.google_maps_places_aggregator.infoWinOpen=!0,this.$vuetify.goTo(0),document.body.scrollTo(0,0),this.centerMap(e.position),this.zoomMap(15)},addMarker(e,t){t?this.markers[t]=e:this.markers.push(e)},centerMap(e){this.center=e},zoomMap(e){this.zoom=e},resetForm(){this.clear(),this.centre="",this.customLatitude="",this.customLongitude="",this.currentID=null,this.place=null,this.persistent=!1,this.isEdit=!1,this.state=!0,this.addressType="address"}},watch:{dialog(e){e||this.close()}},computed:{valid:function(){return""!==this.centre&&this.place},formTitle(){return-1===this.editedIndex?"New Item":"Edit Item"}}})});